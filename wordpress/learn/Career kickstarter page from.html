<!-- Career kickstarter page form -->
<script>
  const formPopupOpenedEvent = "formPopupOpened"
  document.addEventListener("click", function (event) {
    if (event.target.closest("#unlock-my-prep-kit")) {
      const formPopupOpened = new CustomEvent(formPopupOpenedEvent);
      document.dispatchEvent(formPopupOpened);
    }
  });
</script>
<script>
  function renderSlotsOnForm() {
    // Select *all* elements with class "slot_fild"
    // const slotFields = document.getElementById("form-multistep")?.querySelectorAll(".slot_fild");
    let limitedSlots = webinarSlots?.slice(0, 6);
    // if limited slots is empty or null
    if (!limitedSlots || limitedSlots?.length === 0) {
      limitedSlots = staticSlots?.slice(0, 6);
    }
    // For each .slot_fild container
    document.getElementById("form-multistep")?.querySelectorAll(".slot_fild")?.forEach(function (slotField) {
      slotField.innerHTML = "";

      limitedSlots.forEach(function (slot, index) {
        // Create the outer label (slot-inner)
        let createWebniarSlotDiv = document.createElement("label");
        createWebniarSlotDiv.classList.add("slot-inner");

        // Create the label that wraps our input + content
        let createWebniarSlot = document.createElement("label");
        createWebniarSlot.classList.add("slot", "custom-radio");

        // Build the inner HTML for our slot
        let slotInner = `
          <input 
            type="radio" 
            name="v2_slot" 
            class="v2_slot_radio"
            value="${slot.start_time}"
            data-endtime="${slot.end_time}" 
            data-invitee_starttime="${slot.invitee_start_time}" 
            data-invitee_endtime="${slot.invitee_end_time}" 
            data-name="${slot.start_time}" 
            data-webinar_lead_type="${slot.webinar_lead_type}" 
            ${index === 0 ? "checked" : ""}
            slot-index="${index}"
          >
          <div class="time_slot_wrapper slot-content">
            <span class="v2_day">${slot.weekday.slice(0, 3).toUpperCase()}</span>
            <h3 class="v2_date">${slot.day}</h3>
            <p class="v2_time">${slot.hour}:${slot.minute} ${slot.am_or_pm}</p>
          </div>
        `;

        // Conditionally add a tag if index=0 or if day is Saturday
        if (index === 0 || slot.weekday === "Saturday") {
          slotInner += `
            <div class="filling-tag alert-tag-warning" alart_type="warning">
              Filling fast
            </div>
          `;
        }

        // Inject the slotInner HTML
        createWebniarSlot.innerHTML = slotInner;

        // Append the label-within-a-label
        createWebniarSlotDiv.appendChild(createWebniarSlot);

        // Finally, append to the current .slot_fild container
        slotField.appendChild(createWebniarSlotDiv);
      });
    });
  }
  window.addEventListener("DOMContentLoaded", function () {
    document.addEventListener(formPopupOpenedEvent, function () {
      renderSlotsOnForm();
    });
  });
</script>


<!-- From send -->
<script>
  let isPartner = location.pathname.startsWith("/partner/");
  document.addEventListener(formPopupOpenedEvent, function () {

    // TODO: this should net be here.
    if (!mobileDevice()) {
      document.querySelectorAll('.only-mobile')?.forEach(element => element?.remove());
    } else {
      document.getElementById("mobilehide")?.remove();
    }

    document.getElementById("form-multistep").querySelector(".time_zone").innerHTML = `Time Zone: ${v_timezone}`;

    // const webNearFullName2 = document.getElementById("form-multistep").querySelector('input.fr_name_fl');
    // const webNearEmailAddress2 = document.getElementById("form-multistep").querySelector('.fr_email_fl');
    // const webNearPhoneNumber2= document.getElementById("form-multistep").querySelector('.fr_phone_fl');
    // const dwebNearAccepTance = document.getElementById("form-multistep").querySelector('.fr_acceptance input#Whatsapp-User-Consent');

    // const webNearSlots2 = document.getElementById("form-multistep").querySelector('.slot_fild');

    // const getFnErrMsg2 = document.getElementById("form-multistep").querySelector('input.fr_name_fl').closest('.form-group').querySelector('.error-message');
    // const getEmErrMsg2 = document.getElementById("form-multistep").querySelector('.fr_email_fl').closest('.form-group').querySelector('.error-message');
    // const getPhErrMsg2 = document.getElementById("form-multistep").querySelector('.fr_phone_fl').closest('.form-group').querySelector('.error-message');

    let LeadCreatedTime = null;

    // document.querySelector(".data_web_near_close").addEventListener("click", function () {
    //   document.querySelector(".complete_message").setAttribute('show_status', false);
    //   document.getElementById("form-multistep").setAttribute("active_step", 1);
    // })

    // name container
    const webNearInfo2 = {
      firstName: "",
      lastName: "",
      whatsAppUserConsent: "Yes",
      fPhoneNumber: "",
      utm_source: "",
      utm_medium: "",
      utm_campaign: "",
      utm_adset: "",
      utm_content: "",
      utm_term: "",
      page_url: page_url,
      site_url: window.location.hostname,
      user_id: "",
      gclid: "",
      salesforce_uuid: "",
      msclkid: "",
      fbclid: "",
      fbcId: null,
      fbpId: null,
      userAgent: "",
      li_fat_id: "",
      user_timezone: "",
      l_page_url: "",
      cta_page_url: "",
      webinar_type: "",
      eventname: "",
      wr__referrer: "",
      wr__device: "",
      webinar_lead_type: "",
      bye_calendly_type: "",
      is_exit_intent_popup: "",
      v_country: "",
      wr__region: "",
      wr__city: "",
      irclickid: "",

      eventStartTime: "",
      eventEndTime: "",
      inviteStartTime: "",
      inviteEndTime: "",
    };

    //check regex
    let name_regex2 = new RegExp("^[a-zA-Z ]+$");
    let email_regex2 = /^([a-zA-Z0-9_\.\-\+])+\@(([a-zA-Z0-9\-])+\.)+([a-zA-Z0-9]{2,4})+$/;
    let phone_regex2 = /^(\+\d{1,2}\s?)?1?\-?\.?\s?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}$/;

    // getlocation json
    (async function () {
      let response = await fetch("https://get.geojs.io/v1/ip/geo.json");
      let data = await response.json();
      webNearInfo2.v_country = data.country;
      webNearInfo2.wr__region = data.region;
      webNearInfo2.wr__city = data.city;
    })();

    function getCookieValue(cookieName) {
      const value = `; ${document.cookie}`;
      const parts = value.split(`; ${cookieName}=`);
      if (parts.length === 2) return parts.pop().split(';').shift();
    }

    function setHiddenFields2() {
      //  let params = read_cookie("v_latest");
      function getParams(t) { var t = t ? t.split("?")[1] : window.location.search.slice(1), r = {}; if (t) for (var s = (t = t.split("#")[0]).split("&"), e = 0; e < s.length; e++) { var a, n = s[e].split("="), i = n[0], o = void 0 === n[1] ? void 0 : n[1]; (i = i.toLowerCase()).match(/\[(\d+)?\]$/) ? (r[a = i.replace(/\[(\d+)?\]/, "")] || (r[a] = []), i.match(/\[\d+\]$/) ? (n = /\[(\d+)\]/.exec(i)[1], r[a][n] = o) : r[a].push(o)) : r[i] ? ("string" == typeof r[i] && (r[i] = [r[i]]), r[i].push(o)) : r[i] = o } return r }
      let params = [];
      try {
        params = read_cookie("v_latest") || getParams()
        bake_cookie("v_latest", params);
      } catch (error) {
        console.error("Error while reading cookie", error);
      }
      const fbcFromCookies = getCookieValue('_fbc');
      const fbp = getCookieValue('_fbp');
      const userAgent = navigator?.userAgent;
      const fbclid = decodeURIComponent(params['fbclid'] || "");
      let fbc = fbcFromCookies;
      if (!fbcFromCookies && fbclid) {
        // Generate fbc from fbclid
        const domainParts = window.location.hostname.split('.');
        const subdomainIndex = domainParts.length - 1;
        const creationTime = Date.now();
        fbc = `fb.${subdomainIndex}.${creationTime}.${fbclid}`;
      }
      let whatsAppUserConsentValue = "";
      const fr_acceptance = document.querySelector(".fr_acceptance");
      if (fr_acceptance && getComputedStyle(fr_acceptance).display === "none") {
        whatsAppUserConsentValue = "";
      } else if (document.getElementById("form-multistep").querySelector('.fr_acceptance input#Whatsapp-User-Consent')) {
        whatsAppUserConsentValue = document.getElementById("form-multistep").querySelector('.fr_acceptance input#Whatsapp-User-Consent').checked ? "Yes" : "No";
        document.getElementById("form-multistep").querySelector('.fr_acceptance input#Whatsapp-User-Consent').addEventListener('change', function () {
          if (this.checked) {
            webNearInfo2.whatsAppUserConsent = 'Yes';
          } else {
            webNearInfo2.whatsAppUserConsent = 'No';
          }
        });
      }
      webNearInfo2.whatsAppUserConsent = whatsAppUserConsentValue;
      webNearInfo2.utm_source = decodeURIComponent(params['utm_source'] || "Organic");
      webNearInfo2.utm_medium = decodeURIComponent(params['utm_medium'] || "");
      webNearInfo2.utm_campaign = decodeURIComponent(params['utm_campaign'] || "");
      webNearInfo2.utm_content = decodeURIComponent(params['utm_content'] || "");
      webNearInfo2.utm_term = decodeURIComponent(params['utm_term'] || "");
      webNearInfo2.utm_adset = decodeURIComponent(params['utm_adset'] || "");
      webNearInfo2.gclid = decodeURIComponent(params['utm_term'] || "");
      webNearInfo2.salesforce_uuid = decodeURIComponent(params['salesforce_uuid'] || "");
      webNearInfo2.msclkid = decodeURIComponent(params['msclkid'] || "");
      webNearInfo2.fbclid = fbclid;
      webNearInfo2.fbcId = fbc || null;
      webNearInfo2.fbpId = fbp || null;
      webNearInfo2.userAgent = userAgent;
      webNearInfo2.li_fat_id = decodeURIComponent(params['li_fat_id'] || "");

      webNearInfo2.user_id = visitor_id;
      webNearInfo2.user_timezone = v_timezone;
      //     webNearInfo2.l_page_url = "learn.ik" + getCookie("ik-landingpage");
      if ((referrer || '') != "") {
        webNearInfo2.l_page_url = "learn.ik/" + (referrer || '').split("/").pop();
      } else {
        webNearInfo2.l_page_url = "learn.ik/" + page_url.split("/").pop();
      }
      webNearInfo2.cta_page_url = "learn.ik" + cta_lp;
      webNearInfo2.webinar_type = webinarType;
      webNearInfo2.eventname = eventName;
      webNearInfo2.wr__referrer = referrer;
      webNearInfo2.wr__device = getDeviceType();

      webNearInfo2.webinar_lead_type = webinarType;
      webNearInfo2.bye_calendly_type = "";
      webNearInfo2.is_exit_intent_popup = "No";
      webNearInfo2.irclickid = decodeURIComponent(params['irclickid'] || "");
    }
    setHiddenFields2();

    async function pushToEndPoint2(endpoint) {
      let getCheckWebnear = getSelectedSlot();
      webNearInfo2.eventStartTime = getCheckWebnear.value;
      webNearInfo2.eventEndTime = getCheckWebnear.getAttribute('data-endtime');
      webNearInfo2.inviteStartTime = getCheckWebnear.getAttribute('data-invitee_starttime');
      webNearInfo2.inviteEndTime = getCheckWebnear.getAttribute('data-invitee_endtime');

      let formData = {
        "First Name": webNearInfo2.firstName,
        "Last Name": webNearInfo2.lastName,
        "whatsAppUserConsent": webNearInfo2.whatsAppUserConsent,
        "Email Address": document.getElementById("form-multistep").querySelector('.fr_email_fl').value,
        "ByeCalendlyType": webNearInfo2.bye_calendly_type,
        "webinar-type": webNearInfo2.webinar_type,
        "Webinar Lead Type": webNearInfo2.webinar_lead_type,
        "utm_source": webNearInfo2.utm_source,
        "utm_medium": webNearInfo2.utm_medium,
        "utm_campaign": webNearInfo2.utm_campaign,
        "utm_content": webNearInfo2.utm_content,
        "utm_adset": webNearInfo2.utm_adset,
        "utm_term": webNearInfo2.utm_term,

        "City": webNearInfo2.wr__city,
        "Device": webNearInfo2.wr__device,
        "Referrer": webNearInfo2.wr__referrer,
        "Region": webNearInfo2.wr__region,

        "gclid": webNearInfo2.gclid,
        "msclkid": webNearInfo2.msclkid,
        "fbclid": webNearInfo2.fbclid,
        "fbpId": webNearInfo2.fbpId,
        "fbcId": webNearInfo2.fbcId,
        "user_agent": webNearInfo2.userAgent,
        "user_id": webNearInfo2.user_id,
        "li_fat_id": webNearInfo2.li_fat_id,

        "cta_page_url": webNearInfo2.cta_page_url,
        "landing_page_url": webNearInfo2.l_page_url,
        "event_name": webNearInfo2.eventname,
        "user_timezone": webNearInfo2.user_timezone,
        "page_url": webNearInfo2.page_url,
        "site_url": webNearInfo2.site_url,
        "v_country": webNearInfo2.v_country,
        "salesforce_uuid": webNearInfo2.salesforce_uuid,
        "phone_number_full": webNearInfo2.fPhoneNumber,
        "is_exit_intent_popup": webNearInfo2.is_exit_intent_popup,
        "irclickid": webNearInfo2.irclickid,

        "Event Start Time": webNearInfo2.eventStartTime,
        "Event End Time": webNearInfo2.eventEndTime,
        "Invitee Start Time": webNearInfo2.inviteStartTime,
        "Invitee End Time": webNearInfo2.inviteEndTime,
        ...userIpAndBrowserInfo
      };

      let options = {
        method: 'POST',
        mode: "no-cors",
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(formData),
      };

      try {
        const sendData = await fetch(endpoint, options);
        return sendData;
      } catch (err) {
        console.error("P0: The Zapier Webhook Failed.", err);
      }
    }


    function hideError2() {
      document.getElementById("form-multistep").querySelector('input.fr_name_fl').closest('.form-group').querySelector('.error-message').classList.remove('visible');
      document.getElementById("form-multistep").querySelector('.fr_email_fl').closest('.form-group').querySelector('.error-message').classList.remove('visible');
      document.getElementById("form-multistep").querySelector('.fr_phone_fl').closest('.form-group').querySelector('.error-message').classList.remove('visible');
    }

    function mobileFormSteps(fromStep, toStep) {
      const mobileFormContainer = document.getElementById("form-multistep");
      const firstStepAccordian = mobileFormContainer.querySelector('.accordion-tab:first-child');
      const secondStepAccordian = mobileFormContainer.querySelector('.accordion-tab:nth-child(2)');
      const formSubmitButton = mobileFormContainer.querySelector('.pag-item-next');
      const formBackButton = mobileFormContainer.querySelector('.pag-item-prev');

      if (fromStep == 1 && toStep == 2) {
        firstStepAccordian.classList.add('active-tab-two');
        formSubmitButton.classList.remove('step_btn_1');
        formSubmitButton.classList.add('step_btn_2');

        formBackButton.classList.remove('hidden');
        formBackButton.classList.remove("step_back_1");
        formBackButton.classList.add("step_back_2");
      } else if (fromStep == 2 && toStep == 1) { //back
        firstStepAccordian.classList.remove('active-tab-two');
        formSubmitButton.classList.remove('step_btn_2');
        formSubmitButton.classList.add('step_btn_1');

        formBackButton.classList.add('hidden');
        formBackButton.classList.add("step_back_1")
        formBackButton.classList.remove("step_back_2");
      } else if (fromStep == 2 && toStep == 3) {
        firstStepAccordian.classList.add('finished');
        firstStepAccordian.querySelector(".accordion-header").classList.remove("active")
        firstStepAccordian.classList.remove('active-tab-two');

        secondStepAccordian.classList.add('active');
        secondStepAccordian.querySelector(".accordion-header").classList.add("active")

        formSubmitButton.classList.remove('step_btn_2');
        formSubmitButton.classList.add('step_btn_3');

        formBackButton.classList.remove("step_back_2");
        formBackButton.classList.add("step_back_3");
      } else if (fromStep == 3 && toStep == 2) { //back
        firstStepAccordian.classList.remove('finished');
        firstStepAccordian.querySelector(".accordion-header").classList.add("active")
        firstStepAccordian.classList.add('active-tab-two');

        secondStepAccordian.classList.remove('active');
        secondStepAccordian.querySelector(".accordion-header").classList.remove("active")

        formSubmitButton.classList.remove('step_btn_3');
        formSubmitButton.classList.add('step_btn_2');

        formBackButton.classList.remove("step_back_3");
        formBackButton.classList.add("step_back_2");
      }
    }

    function getSelectedSlot() {
      let selectedSlot = document.getElementById("form-multistep").querySelector('.slot_fild').querySelector('input[name="v2_slot"]:checked');
      if (selectedSlot == null) {
        renderSlotsOnForm();
        selectedSlot = document.getElementById("form-multistep").querySelector('.slot_fild').querySelector('input[name="v2_slot"]:checked');
      }
      if (selectedSlot == null) {
        return document.getElementById("form-multistep").querySelector('.slot_fild').querySelector('input[name="v2_slot"]');
      }
      return document.getElementById("form-multistep").querySelector('.slot_fild').querySelector('input[name="v2_slot"]:checked');
    }

    function leftStepSlider(from, to) {
      const get_left_steps = document.querySelectorAll('.left-steps-main .left-steps');
      const wrapper = document.querySelector(".left-content-wrapper.only-desktop");
      if (!wrapper) return;

      function updateLeftContentText(i) {
        const stepParagraphs = [
          "<strong>Share your details</strong> to get started ✨",
          "<strong>Choose your preferred time</strong> for the FAANG Insights Session ✨",
          "<strong>Share a few details</strong> to tailor your 1:1 consultation ✨"
        ];

        const pElement = wrapper.querySelector("p");
        if (pElement && stepParagraphs[i]) {
          pElement.innerHTML = stepParagraphs[i];
        }
      }
      if (from < to) {

        let index = from;
        if (index === 0) {
          get_left_steps.forEach((element, i) => {
            if (i === 0) {
              element.classList.add('active-75');
            }
          });
        } else if (index === 1) {
          get_left_steps.forEach((element, i) => {
            if (i === 0) {
              element.classList.add('finished');
              element.classList.remove('active', 'active-75', 'active-50');
            } else if (i === 1) {
              element.classList.add('active');
            }
          });
        }
        updateLeftContentText(index + 1);

      } else {

        const get_left_steps = document.querySelectorAll('.left-steps-main .left-steps');
        let index = from;

        if (index === 1) {
          get_left_steps.forEach((element, i) => {
            if (i === 0) {
              element.classList.remove('active-75');
            }
          });
        } else if (index === 2) {
          get_left_steps.forEach((element, i) => {
            if (i === 0) {
              element.classList.add('active', 'active-50', 'active-75');
              element.classList.remove('finished');
            }
            if (i === 1) {
              element.classList.remove('active');
            }
          });
        }

        updateLeftContentText(index - 1);
      }
    }

    function topStepSlider(toStep) {
      const get_top_steps = document.querySelectorAll('.tab-nav .nav-item');
      get_top_steps.forEach((element, i) => {
        if (i < toStep) {
          element.classList.add('selected');
        } else {
          element.classList.remove('selected');
        }
      });
    }

    function updateCarosual(toStep) {
      const carouselSteps = [
        [
          "<strong>25,000+ engineers</strong> have fast-tracked their FAANG+ journey with Interview Kickstart",
          "<strong> Backed by 650+ </strong> instructors from Google, Meta, Apple, Netflix, and other top tech companies",
          "<strong> Proven outcomes </strong> with offers from Google, Amazon, LinkedIn, and more"
        ],
        [
          "<strong>97% of attendees </strong> say this webinar changed how they approach FAANG interviews",
          "<strong> 25,000+ engineers </strong> have fast-tracked their FAANG+ journey with Interview Kickstart",
          "<strong> Backed by 650+ </strong> instructors from Google, Meta, Apple, Netflix, and other top tech companies",
          "<strong> Proven outcomes </strong> with offers from Google, Amazon, LinkedIn, and more"
        ],
        [
          "<strong>85% of users </strong> say this 1:1 call clarified their next best step toward a FAANG+ role",
          "<strong> 25,000+ engineers </strong> have fast-tracked their FAANG+ journey with Interview Kickstart",
          "<strong> Backed by 650+ </strong> instructors from Google, Meta, Apple, Netflix, and other top tech companies",
          "<strong> Proven outcomes </strong> with offers from Google, Amazon, LinkedIn, and more",
          "<strong> 97% of attendees </strong> say this webinar changed how they approach FAANG interviews"
        ]
      ];


      /*
      <div class="fast-tracked-main only-desktop">
      <div class="carousel-text-wrapper">
        <p class="fast-tracked-inner carousel-text active"><strong>25,000+ engineers</strong> have fast-tracked their FAANG+
          journey with Interview Kickstart</p>
        <p class="fast-tracked-inner carousel-text"><strong> Backed by 650+ </strong> instructors from Google, Meta, Apple,
          Netflix, and other top tech companies</p>
        <p class="fast-tracked-inner carousel-text"><strong> Proven outcomes </strong> with offers from Google, Amazon,
          LinkedIn, and more</p>
      </div>
      <div class="carousel-dots"><span class="dot active" data-index="0"></span><span class="dot"
          data-index="1"></span><span class="dot" data-index="2"></span></div>
    </div>
      */
      //  This is component example. based on the toStep we need to pick data from carouselSteps and update on the component. carousel-text-wrapper and also update the carousel-dots
      const carouselTextWrapper = document.querySelector('.carousel-text-wrapper');
      const carouselDots = document.querySelector('.carousel-dots');

      // Clear existing content
      carouselTextWrapper.innerHTML = '';
      carouselDots.innerHTML = '';

      // Add new content based on the selected step
      carouselSteps[toStep - 1].forEach((text, index) => {
        const pElement = document.createElement('p');
        pElement.classList.add('fast-tracked-inner', 'carousel-text');
        if (index === 0) {
          pElement.classList.add('active');
        }
        pElement.innerHTML = text;
        carouselTextWrapper.appendChild(pElement);

        const dotElement = document.createElement('span');
        dotElement.classList.add('dot');
        if (index === 0) {
          dotElement.classList.add('active');
        }
        dotElement.setAttribute('data-index', index);
        carouselDots.appendChild(dotElement);
      });

    }

    function changeFormStep(fromStep, toStep) {
      if (mobileDevice()) {
        return mobileFormSteps(fromStep, toStep);
      }
      topStepSlider(toStep);
      updateCarosual(toStep);
      leftStepSlider(fromStep - 1, toStep - 1);
      // Step button class name correction (only one button, so update the class for that button)
      const stepButton = document.getElementById("form-multistep").querySelector('.pag-item-next');
      const backButton = document.getElementById("form-multistep").querySelector('.pag-item-prev');

      stepButton.classList.remove(`step_btn_${fromStep}`);
      stepButton.classList.add(`step_btn_${toStep}`);

      // Back button visibility handling (hide on Step 1, show on Step 2 and Step 3)
      const backButtonAllSteps = document.getElementById("form-multistep").querySelectorAll('.step_back');

      // Hide back button on Step 1
      if (toStep === 1) {
        backButtonAllSteps.forEach(button => button.classList.add('hidden'));
      } else {
        backButtonAllSteps.forEach(button => button.classList.remove('hidden'));
      }

      backButton.classList.remove(`step_back_${fromStep}`);
      backButton.classList.add(`step_back_${toStep}`);

      // Display change for steps
      const fromStepDiv = document.getElementById("form-multistep").querySelector(`div[data-name="Step ${fromStep}"]`);
      const toStepDiv = document.getElementById("form-multistep").querySelector(`div[data-name="Step ${toStep}"]`);
      fromStepDiv.classList.remove('selected');
      toStepDiv.classList.add('selected');
    }

    function updateWebinarTimeOnSuccess(data) {
      const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];


      const getCheckWebnear = getSelectedSlot();
      const getFullData = webinarSlots[parseInt(getCheckWebnear.getAttribute("slot-index"))];

      const dateString = `${getFullData.weekday}, ${getFullData.day} ${months[parseInt(getFullData.month) - 1]}, ${getFullData.hour}:${getFullData.minute} ${getFullData.am_or_pm}`

      var tyCard = document.querySelector('.ty-card');
      var dateElement = tyCard.querySelector('h3');
      if (dateElement) {
        dateElement.textContent = dateString;
      }

      const PASlot = data['PA Consult Time'];
      const PASlotBar = document.querySelector('.ty-main')?.querySelector(".pa-slots");
      if (PASlot) {
        if (PASlotBar.querySelector("h3")) {
          PASlotBar.querySelector("h3").textContent = PASlot;
        }
      } else {
        // remvove paslotbar
        PASlotBar.remove();
      }
    }

    function step4ToSuccessSection(data) {
      document.getElementById('form-multistep').style.display = 'none';
      updateWebinarTimeOnSuccess(data);

      let element = document.querySelector('.ty-main');
      element.style.display = 'block';
      element.style.opacity = 0;

      let fadeIn = function () {
        let opacity = parseFloat(element.style.opacity);
        if (opacity < 1) {
          element.style.opacity = opacity + 0.05; // Adjust the step size to control the speed
          requestAnimationFrame(fadeIn); // Keep calling the function until opacity reaches 1
        }
      };

      fadeIn();
    }

    // First Form Submittion
    function fromSend1stStep2() {
      function track(step, message) {
        typeof saveFormEventsActivity === 'function' ? saveFormEventsActivity(step, null, null, message) : console.error("saveFormEventsActivity is not a function");
      }
      const step1container = document.querySelector('div[data-name="Step 1"]')
      if (step1container.querySelector('.error-message.visible')) {
        return;
      }

      setHiddenFields2();

      let fullname = document.getElementById("form-multistep").querySelector('input.fr_name_fl').value.trim();
      let wEmail = document.getElementById("form-multistep").querySelector('.fr_email_fl').value;
      let fullPhoneNumber = document.getElementById("form-multistep").querySelector('.fr_phone_fl').value;

      //Hide errors
      document.getElementById("form-multistep").querySelector('input.fr_name_fl').addEventListener('input', hideError2);
      document.getElementById("form-multistep").querySelector('.fr_email_fl').addEventListener('input', hideError2);
      document.getElementById("form-multistep").querySelector('.fr_phone_fl').addEventListener('input', hideError2);
      document.getElementById("form-multistep").querySelector('input.fr_name_fl').addEventListener('focus', hideError2);
      document.getElementById("form-multistep").querySelector('.fr_email_fl').addEventListener('focus', hideError2);
      document.getElementById("form-multistep").querySelector('.fr_phone_fl').addEventListener('focus', hideError2);


      //Error check
      if ((fullname.length == 0) && (wEmail.length == 0) && (fullPhoneNumber.length == 0)) {
        document.getElementById("form-multistep").querySelector('input.fr_name_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        document.getElementById("form-multistep").querySelector('.fr_email_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        document.getElementById("form-multistep").querySelector('.fr_phone_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        track("info-e", "validation-general");
        return;
      } else if (!name_regex2.test(fullname) || fullname.length == 0) {
        document.getElementById("form-multistep").querySelector('input.fr_name_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        track("info-e", "validation-name");
        return;
      } else if (!email_regex2.test(wEmail) || wEmail.length == 0) {
        document.getElementById("form-multistep").querySelector('.fr_email_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        track("info-e", "validation-email");
        return;
      } else if (!phone_regex2.test(fullPhoneNumber) || fullPhoneNumber.length == 0) {
        document.getElementById("form-multistep").querySelector('.fr_phone_fl').closest('.form-group').querySelector('.error-message').classList.add('visible');
        track("info-e", "validation-phone");
        return;
      } else {

        if (fullname.substring(0, fullname.indexOf(' ')) == '') {
          webNearInfo2.firstName = fullname.substring(fullname.indexOf(' ') + 1);
          webNearInfo2.lastName = fullname.substring(fullname.indexOf(' ') + 1);
        } else if (fullname.substring(fullname.indexOf(' ') + 1) == '') {
          webNearInfo2.firstName = fullname.substring(0, fullname.indexOf(' '));
          webNearInfo2.lastName = fullname.substring(0, fullname.indexOf(' '));
        } else {
          webNearInfo2.firstName = fullname.substring(0, fullname.indexOf(' '));
          webNearInfo2.lastName = fullname.substring(fullname.indexOf(' ') + 1);
        }

        try {
          dataLayer.push({
            'event': 'pa_new_webinar_registration_form_submitted',
            'webinar_name': webNearInfo.eventname
          });
        } catch (err) {
          console.log("Data Layer add faild");
          console.log(err);
          track("info-e", "reporting-data-layer");
        }

        // webNearInfo2.fPhoneNumber = webNearPhoneNumberWri2.getNumber(intlTelInputUtils.numberFormat.E164);
        let webNearPhoneNumberWri2;
        try {
          webNearPhoneNumberWri2 = window.intlTelInputGlobals.getInstance(document.getElementById("form-multistep").querySelector('.fr_phone_fl'))
        } catch (error) {

        }
        webNearInfo2.fPhoneNumber = "";
        if (typeof intlTelInputUtils == "undefined") {
          try {
            webNearInfo2.fPhoneNumber = `+${webNearPhoneNumberWri2.getSelectedCountryData().dialCode || ""}${document.querySelector(".fr_phone_fl")?.value}`;
          } catch (error) {
            console.error("Error while getting phone number", error);
            webNearInfo2.fPhoneNumber = document.querySelector(".fr_phone_fl")?.value;
          }
        } else {
          webNearInfo2.fPhoneNumber = webNearPhoneNumberWri2.getNumber(intlTelInputUtils.numberFormat.E164);
        }
        let zapUrl = isPartner ? "https://hooks.zapier.com/hooks/catch/11068981/21gkn2x/" : "https://hooks.zapier.com/hooks/catch/11068981/340hd4j/";

        pushToEndPoint2(zapUrl)
          .then(() => {
            changeFormStep(1, 2);
            // document.getElementById("form-multistep").setAttribute("active_step", 2);
            track("info");
          }).catch(() => {
            track("info-e", "flow-zapier");
          });
      }
    }


    // Second Form Submition
    function fromSend2ndStep2() {
      function track(step, message) {
        typeof saveFormEventsActivity === 'function' ? saveFormEventsActivity(step, null, null, message) : console.error("saveFormEventsActivity is not a function");
      }
      const getCheckWebnear = getSelectedSlot();

      let utmm = visitor_id + ":" + webNearInfo2.v_country;
      let sf_uuid = v_timezone + ":learn.ik" + cta_lp + ":learn.ik" + getCookie("ik-landingpage");
      webNearInfo2.salesforce_uuid = sf_uuid;
      let utmstring = {
        assigned_to: "Interview Kickstart",
        invitee_first_name: webNearInfo2.firstName,
        invitee_last_name: webNearInfo2.lastName,
        invitee_email: document.getElementById("form-multistep").querySelector('.fr_email_fl').value,
        answer_1: webNearInfo2.fPhoneNumber,
        event_start_time: getCheckWebnear.value,
        event_end_time: getCheckWebnear.getAttribute('data-endtime'),
        utm_medium: utmm,
        salesforce_uuid: sf_uuid,
        whatsapp_consent: true
      };

      bake_cookie("from_cookie", utmstring);
      let pushUrl = is_webinar_1o1_eligible ? "https://hooks.zapier.com/hooks/catch/11068981/2dvpcc1/" : "https://hooks.zapier.com/hooks/catch/11068981/340hl1a/";
      pushUrl = isPartner ? "https://hooks.zapier.com/hooks/catch/11068981/340hl1a/" : pushUrl;
      pushToEndPoint2(pushUrl)
        .then(() => {
          changeFormStep(2, 3);
          track("slot");
          secondStepSecondRequest2();
        }).catch(() => {
          track("slot-e", "flow-zapier");
        });
    }


    // const getWorkExperience = document.getElementById("form-multistep").querySelector('.gql_exp_select');
    // const getDomainRole = document.getElementById("form-multistep").querySelector('.gql_domain_select');
    // const getStartIn = document.getElementById("form-multistep").querySelector('.gql_int_select');
    // const getIsStudent = document.getElementById("form-multistep").querySelector('.v2-checkbox-is-student');
    // const getIsLaidOff = document.getElementById("form-multistep").querySelector('.v2-checkbox-is-laidoff');

    // const errWorkEx = document.getElementById("form-multistep").querySelector('.v2_exp_fild');
    // const errDomEx = document.getElementById("form-multistep").querySelector('.gql_domain_select').closest('.form-group').querySelector('.error-message');
    // const errInEx = document.getElementById("form-multistep").querySelector('.v2_int_fild');

    document.getElementById("form-multistep").querySelectorAll('input[name="experience"]').forEach((input) => {
      input.addEventListener('change', () => {
        document.getElementById("form-multistep").querySelector('.gql_exp_select').closest('.form-group').querySelector('.error-message').classList.remove('visible');
      });
    });

    document.getElementById("form-multistep").querySelector('.gql_domain_select').addEventListener('change', function () {
      document.getElementById("form-multistep").querySelector('.gql_domain_select').closest('.form-group').querySelector('.error-message').classList.remove('visible');
    })

    // getStartIn.addEventListener('change', function () {
    //   errInEx.classList.remove('visible');
    // })

    function fromSend3rdStep2() {
      function track(step, message) {
        typeof saveFormEventsActivity === 'function' ? saveFormEventsActivity(step, null, null, message) : console.error("saveFormEventsActivity is not a function");
      }

      let paSlot = document.getElementById("form-multistep").querySelector('input[name="time-slot"]:checked')?.value;
      let v2WorkExp = document.getElementById("form-multistep").querySelector('input[name="experience"]:checked')?.value;
      let v2DomExp = document.getElementById("form-multistep").querySelector('.gql_domain_select')?.value;
      // let v2StarExp = getStartIn.value;
      // let v2IsStudent = getIsStudent.checked;
      // let v2IsLaidOff = getIsLaidOff.checked;

      let gqlErrStatus = false;

      if (!v2WorkExp) {
        gqlErrStatus = true;
        document.getElementById("form-multistep").querySelector('.gql_exp_select').closest('.form-group').querySelector('.error-message').classList.add('visible');;
      }
      if (!v2DomExp) {
        gqlErrStatus = true;
        document.getElementById("form-multistep").querySelector('.gql_domain_select').closest('.form-group').querySelector('.error-message').classList.add('visible');;
      }
      // if (!v2StarExp) {
      //   gqlErrStatus = true;
      //   errInEx.setAttribute('err_status', gqlErrStatus);
      // }

      if (!gqlErrStatus) {
        let GQLformData = {
          'First Name': webNearInfo2.firstName,
          'Last Name': webNearInfo2.lastName,
          'Email Address': document.getElementById("form-multistep").querySelector('.fr_email_fl').value,
          utm_source: webNearInfo2.utm_source,
          utm_medium: webNearInfo2.utm_medium,
          utm_campaign: webNearInfo2.utm_campaign,
          utm_term: webNearInfo2.utm_term,
          gclid: webNearInfo2.gclid,
          msclkid: webNearInfo2.msclkid,
          "fbclid": webNearInfo2.fbclid,
          "fbpId": webNearInfo2.fbpId,
          "fbcId": webNearInfo2.fbcId,
          user_id: visitor_id,
          user_timezone: v_timezone,
          v_country: v_country,
          phone_number_full: webNearInfo2.fPhoneNumber,
          'Event Start Time': webNearInfo2.eventStartTime,
          'Event End Time': webNearInfo2.eventEndTime,
          'Work Experience': v2WorkExp,
          'Role Domain': v2DomExp,
          'PA Consult Time': paSlot,
          // 'PA Consult Time Other': "",
          // 'Interview Start Time': v2StarExp,
          // 'Laid Off': v2IsLaidOff,
          // 'Is Student': v2IsStudent,
          salesforce_uuid: webNearInfo2.salesforce_uuid,
        };

        try {
          dataLayer.push({
            event: "wordpress_form_submitted",
            formName: "Lead Qualifier Form",
          })
        } catch (err) {
          console.log("error in data layer push");
        }
        let zapUrl = isPartner ? "https://hooks.zapier.com/hooks/catch/11068981/3409hxu/" : "https://hooks.zapier.com/hooks/catch/11068981/3409hxu/";

        sendRequestZapiar(zapUrl, GQLformData, track);
      } else {
        track("gql-e", "validation-gql");
      }
    }

    async function sendRequestZapiar(url, data, callback = null) {
      let options = {
        method: 'POST',
        mode: "no-cors",
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(data),
      };

      try {
        let response = await fetch(url, options);
        pushDataToExpertInsightApp(
          data['Work Experience'],
          data['Role Domain'],
          data['PA Consult Time']
        );
        step4ToSuccessSection(data);
        if (typeof callback === 'function') {
          callback("gql");
        }
      } catch (error) {
        if (typeof callback === 'function') {
          callback("gql-e", "Zapier Webhook Failed");
        }
        console.error("error in zapier webhook", error);
      }
    }

    function getAPIDetails() {
      //if url contains wpcomstaging than send staging api key & url
      if (window.location.href.includes("wpcomstaging")) {
        return {
          url: "https://jobxp11m92.execute-api.us-west-1.amazonaws.com/qa/expert-insights",
          api_key: "Dn6VOF9g4iGtLJLqMBrL2uNWwhfadgl2kXEIvzQ4"
        }
      } else {
        return {
          url: "https://4nwgymw1h6.execute-api.us-west-1.amazonaws.com/api/expert-insights",
          api_key: "fBF1GVnYKb1hReCbCfrQu7zBt4RgLOvh6inYzYqB"
        }
      }
    }

    async function pushDataToExpertInsightApp(workExperience, domainRole, PASlot) {
      let GqldataPayload = {
        "Work Experience": workExperience,
        "Role Domain": domainRole,
        "slot": PASlot,

        "Lead_Created_Time": LeadCreatedTime,
        "Page_URL": encodeURIComponent(webNearInfo2.page_url),
        "First Name": webNearInfo2.firstName,
        "Last Name": webNearInfo2.lastName,
        "Email Address": document.getElementById("form-multistep").querySelector('.fr_email_fl').value,
        "utm_source": webNearInfo2.utm_source,
        "utm_medium": webNearInfo2.utm_medium,
        "utm_campaign": webNearInfo2.utm_campaign,
        "utm_term": webNearInfo2.utm_term,
        "gclid": webNearInfo2.gclid,
        "msclkid": webNearInfo2.msclkid,
        "fbclid": webNearInfo2.fbclid,
        "user_id": webNearInfo2.user_id,
        "user_timezone": webNearInfo2.user_timezone,
        "v_country": webNearInfo2.v_country,
        "phone_number_full": webNearInfo2.fPhoneNumber,
        "Event Start Time": webNearInfo2.eventStartTime,
        "Event End Time": webNearInfo2.eventEndTime,
        "PA Consult Time": "",
        "PA Consult Time Other": "",
        "Interview Start Time": "",
        "Laid Off": "",
        "Is Student": "",
        "Domain Switch": "",
        "salesforce_uuid": webNearInfo2.salesforce_uuid,
        "linkedin_url": null,
        "resume": null,
        "test_group": "N/A",
      }

      let options = {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'x-api-key': getAPIDetails().api_key },
        body: JSON.stringify(GqldataPayload),
      };

      try {
        const sendData = await fetch(getAPIDetails().url, options); // staging url
        return sendData;
      } catch (err) {
        throw new Error("GQL Faild");
      }
    }

    async function secondStepSecondRequest2() {
      const getCheckWebnear = getSelectedSlot();

      const currentDateTime = new Date();
      LeadCreatedTime = currentDateTime.toISOString().replace(/T/, ' ').replace(/\.\d+Z$/, ' UTC');

      function formatDateTime(dateTimeString) {
        const date = new Date(dateTimeString);
        const year = date.getUTCFullYear();
        const month = (date.getUTCMonth() + 1).toString().padStart(2, '0');
        const day = date.getUTCDate().toString().padStart(2, '0');
        const hours = date.getUTCHours().toString().padStart(2, '0');
        const minutes = date.getUTCMinutes().toString().padStart(2, '0');
        const seconds = date.getUTCSeconds().toString().padStart(2, '0');
        return `${year}-${month}-${day} ${hours}:${minutes}:${seconds} UTC`;
      }

      const formattedStartDateTime = formatDateTime(getCheckWebnear.value);
      const formattedEndDateTime = formatDateTime(getCheckWebnear.getAttribute('data-endtime'));

      let data = [{
        "Lead_Created_Time": LeadCreatedTime,
        "Lead_Name": webNearInfo2.firstName + ' ' + webNearInfo2.lastName,
        "Lead_First_Name": webNearInfo2.firstName,
        "Lead_Last__Name": webNearInfo2.lastName,
        "Lead_Email": document.getElementById("form-multistep").querySelector('.fr_email_fl').value,
        "Lead_Time_Zone": webNearInfo2.user_timezone,
        "Event_Type_Name": eventName,
        "Event_Start_Date_Time": formattedStartDateTime,
        "Event_End_Date_Time": formattedEndDateTime,
        "Cancellation_reason": "",
        "Mobile": webNearInfo2.fPhoneNumber,
        "UTM_Campaign": webNearInfo2.utm_campaign,
        "UTM_Source": webNearInfo2.utm_source,
        "UTM_Medium": webNearInfo2.utm_medium,
        "UTM_Term": webNearInfo2.utm_term,
        "UTM_Content": webNearInfo2.utm_content,
        "Tracking_ID": "",
        "User_ID": webNearInfo2.user_id,
        "Page_URL": encodeURIComponent(webNearInfo2.page_url),
        "Country": webNearInfo2.v_country,
        "Client_Timezone": webNearInfo2.user_timezone,
        "CTA_Page": encodeURIComponent(webNearInfo2.cta_page_url),
        "Landing_Page": encodeURIComponent(webNearInfo2.l_page_url),
        "Webinar_reg_type": "",
        "Webinar_Type": webNearInfo2.webinar_type,
        "Switchup_Lead": webNearInfo2.webinar_lead_type,
        "UUID": webNearInfo2.salesforce_uuid,
        "Click_History": "",
        "City": webNearInfo2.wr__city,
        "Device": webNearInfo.wr__device,
        "User_Agent": encodeURIComponent(navigator?.userAgent || ""),
        "Refferer": encodeURIComponent(webNearInfo2.wr__referrer),
        "Region": webNearInfo2.wr__region,
        "whatsapp_user_consent": webNearInfo2.whatsAppUserConsent,
        "step": "s4"
      }];

      let options = {
        method: 'POST',
        headers: {
          'x-api-key': 'fm0X61U99b80d5SlGjrxFaWjgxIBylhX3LkfYGPN',
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          dataset_id: "Marketing_data_new_logic",
          table_id: "Leads_Click_history",
          data: data,
        }),
        keepalive: true,
      };

      try {
        const response = await fetch('https://nlhtyrnugl.execute-api.us-west-1.amazonaws.com/prod', options);
        return response;
      } catch (err) {
        console.log(err);
      };
    }


    document.addEventListener("click", function (event) {
      const btn = event.target.closest(".step_btn");
      if (!btn) return;
      event.preventDefault();
      event.stopImmediatePropagation();
      event.stopPropagation();
      if (btn.classList.contains("step_btn_1")) {
        try {
          fromSend1stStep2();
        } catch (error) {
          saveFormEventsActivity("info-e", null, null, "Error in 1st step");
        }
      } else if (btn.classList.contains("step_btn_2")) {
        try {
          fromSend2ndStep2();
        } catch (error) {
          saveFormEventsActivity("slot-e", null, null, "Error in 2nd step");
        }
      } else if (btn.classList.contains("step_btn_3")) {
        try {
          fromSend3rdStep2();
        } catch (error) {
          saveFormEventsActivity("gql-e", null, null, "Error in 3rd step");
        }
      } else if (btn.classList.contains("step_back_2")) {
        changeFormStep(2, 1)
      } else if (btn.classList.contains("step_back_3")) {
        changeFormStep(3, 2)
      }
    });
  })
</script>